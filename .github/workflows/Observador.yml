name: Observador

on:
  push:
    branches: [ "main" ]
    tags:
      - 'v*'
  pull_request:
    branches: [ "main" ]
  workflow_dispatch:

jobs:
  build:
    runs-on: macos-latest   # Necessário para build iOS

    steps:
      - name: Checkout do repositório
        uses: actions/checkout@v4

      - name: Configurar Flutter
        uses: subosito/flutter-action@v2
        with:
          flutter-version: "3.35.1"
          channel: stable

      - name: Limpar build anterior
        run: flutter clean

      - name: Instalar dependências
        run: flutter pub get

      - name: Atualizar plugins (force upgrade)
        run: |
          flutter pub outdated || true
          flutter pub upgrade

      - name: Obter versão do build
        id: version
        run: |
          if [ "${GITHUB_EVENT_NAME}" = "pull_request" ]; then
            BUILD_TYPE="pr"
            BUILD_VERSION="pr"
          else
            if [[ "${GITHUB_REF##*/}" == v* ]]; then
              BUILD_TYPE="release"
              BUILD_VERSION="${GITHUB_REF##*/}"
            else
              BUILD_TYPE="beta"
              BUILD_VERSION="beta"
            fi
          fi
          echo "BUILD_VERSION=$BUILD_VERSION" >> $GITHUB_ENV
          echo "BUILD_TYPE=$BUILD_TYPE" >> $GITHUB_ENV

          if [[ "$BUILD_TYPE" == "pr" ]]; then
            VERSION_CODE=10000
          elif [[ "$BUILD_TYPE" == "beta" ]]; then
            VERSION_CODE=20000
          else
            CLEAN_VERSION=$(echo $BUILD_VERSION | sed 's/^v//' | sed 's/[^0-9\.]//g')
            IFS='.' read
